<% content_for :title, @story.title %>

<!-- Turbo Stream subscription for real-time theme updates -->
<%= turbo_stream_from "story_#{@story.id}" %>

<!-- Theme Background -->
<div id="theme_background">
  <%= render "stories/theme_background" %>
</div>

<div id="story_content" class="min-h-screen <%= @theme_data&.dig(:background_image_url).present? ? 'relative z-10' : 'bg-gray-50' %>">
  <!-- Header -->
  <div class="<%= @theme_data&.dig(:background_image_url).present? ? 'bg-white bg-opacity-95 backdrop-blur-sm' : 'bg-white' %> shadow-sm border-b border-gray-200">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between py-4">
        <div class="flex items-center">
          <%= link_to stories_path, class: "mr-3 text-gray-400 hover:text-gray-600" do %>
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
            </svg>
          <% end %>
          <h1 class="text-xl font-semibold text-gray-900"><%= @story.title %></h1>
        </div>
      </div>
    </div>
  </div>

  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
    <!-- Story Details -->
    <div class="<%= @theme_data&.dig(:background_image_url).present? ? 'bg-white bg-opacity-95 backdrop-blur-sm' : 'bg-white' %> rounded-lg shadow-sm border border-gray-200 p-6 mb-6">
      <div class="mb-4">
        <h2 class="text-lg font-semibold text-gray-900 mb-2"><%= @story.title %></h2>
        <p class="text-gray-600"><%= @story.description %></p>
      </div>

      <div class="flex items-center text-sm text-gray-500 mb-4">
        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
        </svg>
        <%= @story.creator.name %>
        <span class="mx-2">â€¢</span>
        <%= @story.created_at.strftime("%B %d, %Y") %>
      </div>

      <% if @story.start_date || @story.end_date %>
        <div class="flex items-center text-sm text-gray-500">
          <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
          </svg>
          <% if @story.start_date && @story.end_date %>
            <%= @story.start_date.strftime("%B %d") %> - <%= @story.end_date.strftime("%B %d, %Y") %>
          <% elsif @story.start_date %>
            <%= @story.start_date.strftime("%B %d, %Y") %>
          <% elsif @story.end_date %>
            <%= @story.end_date.strftime("%B %d, %Y") %>
          <% end %>
        </div>
      <% end %>
    </div>

    <!-- Content Sections -->
    <%= render "stories/content_sections",
               story: @story,
               theme_data: @theme_data,
               grouped_entities: @grouped_entities,
               synthesized_memory: @synthesized_memory,
               comments: @comments %>
  </div>
</div>
