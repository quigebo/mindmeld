<div class="audio-recorder-container" data-controller="audio-recorder" data-audio-recorder-max-duration-value="300">
  <!-- Recording Button with Circular Progress -->
  <div class="flex justify-center mb-6">
    <div class="relative">
      <!-- Circular Progress Ring -->
      <svg class="w-32 h-32 transform -rotate-90" data-audio-recorder-target="progress">
        <!-- Background circle -->
        <circle
          cx="64"
          cy="64"
          r="45"
          stroke="currentColor"
          stroke-width="4"
          fill="transparent"
          class="text-gray-200"
        />
        <!-- Progress circle -->
        <circle
          cx="64"
          cy="64"
          r="45"
          stroke="currentColor"
          stroke-width="4"
          fill="transparent"
          stroke-linecap="round"
          stroke-dasharray="282.743"
          stroke-dashoffset="282.743"
          class="text-blue-500 transition-all duration-100 ease-out"
        />
      </svg>
      
      <!-- Record/Stop Button -->
      <button 
        data-audio-recorder-target="button"
        data-action="click->audio-recorder#toggle"
        class="absolute inset-0 flex items-center justify-center w-32 h-32 rounded-full bg-white shadow-lg hover:shadow-xl transition-all duration-200 transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-blue-500/20"
      >
        <!-- Default microphone icon -->
        <svg class="w-12 h-12 text-blue-500" fill="currentColor" viewBox="0 0 24 24">
          <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/>
          <path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/>
        </svg>
      </button>
    </div>
  </div>

  <!-- Timer Display -->
  <div class="text-center mb-4">
    <div class="text-2xl font-mono font-semibold text-gray-700" data-audio-recorder-target="timer">
      5:00
    </div>
    <p class="text-sm text-gray-500 mt-1">Tap to start recording</p>
  </div>

  <!-- Transcription Display -->
  <div class="mb-6">
    <div class="bg-gray-50 rounded-lg p-4 min-h-[120px] border border-gray-200">
      <div 
        data-audio-recorder-target="transcription" 
        class="text-gray-900 leading-relaxed whitespace-pre-wrap"
      ></div>
    </div>
  </div>

  <!-- Connected Form Field (Hidden) -->
  <div data-audio-recorder-target="form" class="hidden">
    <%= form.text_area :description, rows: 6,
        class: "block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-lg",
        placeholder: placeholder_text %>
  </div>

  <!-- Recording Status -->
  <div class="text-center">
    <div class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-800 opacity-0 transition-opacity duration-300" data-audio-recorder-target="status">
      <svg class="w-4 h-4 mr-2 animate-pulse" fill="currentColor" viewBox="0 0 24 24">
        <circle cx="12" cy="12" r="3"/>
      </svg>
      Recording...
    </div>
  </div>
</div>

<style>
  .audio-recorder-container {
    /* Ensure proper sizing and positioning */
  }
  
  /* Interim transcription styling */
  .interim {
    color: #6b7280;
    font-style: italic;
  }
  
  /* Recording state animations */
  .recording {
    animation: pulse 2s infinite;
  }
  
  @keyframes pulse {
    0%, 100% {
      opacity: 1;
    }
    50% {
      opacity: 0.7;
    }
  }
  
  /* Progress ring animation */
  circle[stroke-dashoffset] {
    transition: stroke-dashoffset 0.1s ease-out;
  }
</style>
